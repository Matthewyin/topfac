import{d as E,r as c,k as I,o as O,g as d,x as P,y as A,z as o,B as n,C as a,D as s,M as z,_ as F}from"./B2GUc6qa.js";const J={class:"ai-config-panel"},R={class:"mb-4"},q={class:"mb-4"},H={class:"mb-4"},L={class:"mb-4"},Q={class:"mb-4"},W={class:"help-content"},X={key:0,class:"provider-help"},Y={key:1,class:"provider-help"},Z=E({__name:"AIConfigPanel",emits:["close"],setup(ee,{emit:le}){const t=c("gemini"),p=c("gemini-2.5-flash"),r=c(""),_=c(!1),f=c(!1),g=c(!1),u=c({}),y=[{id:"gemini",name:"Google Gemini",icon:"mdi-google"},{id:"deepseek",name:"DeepSeek",icon:"mdi-robot"}],h={gemini:[{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash"},{id:"gemini-2.5-pro",name:"Gemini 2.5 Pro"}],deepseek:[{id:"deepseek-chat",name:"DeepSeek Chat"},{id:"deepseek-reasoner",name:"DeepSeek Reasoner"}]},K=I(()=>h[t.value]||[]),b=I(()=>!!u.value[t.value]),V=I(()=>{const l=u.value[t.value];return l?l.substring(0,8)+"..."+l.substring(l.length-4):""}),G=l=>{const e=y.find(i=>i.id===l);return(e==null?void 0:e.icon)||"mdi-robot"},w=l=>{const e=y.find(i=>i.id===l);return(e==null?void 0:e.name)||"AI"},x=()=>{const l=K.value;l.length>0&&(p.value=l[0].id),D()},D=()=>{const l=localStorage.getItem(`ai_api_key_${t.value}`);l&&(u.value[t.value]=l)},$=async()=>{if(!r.value.trim()){alert("请输入 API Key");return}f.value=!0;try{localStorage.setItem(`ai_api_key_${t.value}`,r.value.trim()),u.value[t.value]=r.value.trim(),r.value="",alert("API Key 保存成功！")}catch(l){console.error("保存 API Key 失败:",l),alert("保存失败，请重试")}finally{f.value=!1}},N=async()=>{const l=r.value||u.value[t.value];if(!l){alert("请先输入或保存 API Key");return}g.value=!0;try{const i=await(await fetch("/api/ai/test-connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:t.value,api_key:l,model_name:p.value})})).json();i.success?alert("API Key 测试成功！连接正常"):alert(`API Key 测试失败：${i.error||"未知错误"}`)}catch(e){console.error("API Key 测试失败:",e),alert("测试失败，请检查网络连接")}finally{g.value=!1}},T=()=>{confirm("确定要清除已保存的 API Key 吗？")&&(localStorage.removeItem(`ai_api_key_${t.value}`),delete u.value[t.value],r.value="",alert("API Key 已清除"))};return O(()=>{y.forEach(l=>{const e=localStorage.getItem(`ai_api_key_${l.id}`);e&&(u.value[l.id]=e)}),x()}),(l,e)=>{const i=d("v-label"),m=d("v-icon"),S=d("v-select"),C=d("v-text-field"),k=d("v-btn"),B=d("v-expansion-panel-title"),M=d("v-expansion-panel-text"),U=d("v-expansion-panel"),j=d("v-expansion-panels");return A(),P("div",J,[o("div",R,[n(i,{class:"mb-2"},{default:a(()=>e[4]||(e[4]=[s("选择AI提供商：")])),_:1,__:[4]}),n(S,{modelValue:t.value,"onUpdate:modelValue":[e[0]||(e[0]=v=>t.value=v),x],items:y,"item-title":"name","item-value":"id",variant:"outlined"},{"prepend-inner":a(()=>[n(m,{icon:G(t.value)},null,8,["icon"])]),_:1},8,["modelValue"])]),o("div",q,[n(i,{class:"mb-2"},{default:a(()=>e[5]||(e[5]=[s("模型选择：")])),_:1,__:[5]}),n(S,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=v=>p.value=v),items:K.value,"item-title":"name","item-value":"id",variant:"outlined"},{"prepend-inner":a(()=>[n(m,{icon:"mdi-brain"})]),_:1},8,["modelValue","items"])]),o("div",H,[n(i,{class:"mb-2"},{default:a(()=>e[6]||(e[6]=[s("API Key配置：")])),_:1,__:[6]}),n(C,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=v=>r.value=v),placeholder:`输入${w(t.value)} API Key...`,variant:"outlined",type:_.value?"text":"password","append-inner-icon":_.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[3]||(e[3]=v=>_.value=!_.value)},null,8,["modelValue","placeholder","type","append-inner-icon"])]),o("div",L,[n(k,{color:"primary",variant:"elevated",class:"mr-2",onClick:$,loading:f.value},{default:a(()=>[n(m,{icon:"mdi-content-save",class:"mr-1"}),e[7]||(e[7]=s(" 保存 "))]),_:1,__:[7]},8,["loading"]),n(k,{color:"success",variant:"outlined",class:"mr-2",onClick:N,loading:g.value,disabled:!r.value},{default:a(()=>[n(m,{icon:"mdi-test-tube",class:"mr-1"}),e[8]||(e[8]=s(" 测试连接 "))]),_:1,__:[8]},8,["loading","disabled"]),n(k,{color:"warning",variant:"outlined",onClick:T},{default:a(()=>[n(m,{icon:"mdi-delete",class:"mr-1"}),e[9]||(e[9]=s(" 清除 "))]),_:1,__:[9]})]),o("div",Q,[n(i,{class:"mb-2"},{default:a(()=>e[10]||(e[10]=[s("已保存的API Key：")])),_:1,__:[10]}),n(C,{"model-value":V.value,variant:"outlined",readonly:"",placeholder:"暂无已保存的API Key","prepend-inner-icon":b.value?"mdi-check-circle":"mdi-alert-circle",color:b.value?"success":"warning"},null,8,["model-value","prepend-inner-icon","color"])]),n(j,{class:"mb-4"},{default:a(()=>[n(U,null,{default:a(()=>[n(B,null,{default:a(()=>[n(m,{icon:"mdi-help-circle",class:"mr-2"}),e[11]||(e[11]=s(" 如何获取API Key？ "))]),_:1,__:[11]}),n(M,null,{default:a(()=>[o("div",W,[t.value==="gemini"?(A(),P("div",X,e[12]||(e[12]=[o("h4",null,"Google Gemini API Key",-1),o("ol",null,[o("li",null,[s("访问 "),o("a",{href:"https://makersuite.google.com/app/apikey",target:"_blank"},"Google AI Studio")]),o("li",null,"登录您的 Google 账户"),o("li",null,'点击 "Create API Key" 按钮'),o("li",null,"复制生成的 API Key")],-1)]))):t.value==="deepseek"?(A(),P("div",Y,e[13]||(e[13]=[o("h4",null,"DeepSeek API Key",-1),o("ol",null,[o("li",null,[s("访问 "),o("a",{href:"https://platform.deepseek.com/",target:"_blank"},"DeepSeek Platform")]),o("li",null,"登录您的 DeepSeek 账户"),o("li",null,"进入 API Keys 页面"),o("li",null,"创建新的 API Key")],-1)]))):z("",!0)])]),_:1})]),_:1})]),_:1})])}}}),oe=F(Z,[["__scopeId","data-v-d9fc3996"]]);export{oe as default};
