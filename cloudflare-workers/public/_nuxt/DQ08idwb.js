import fe from"./znlwccst.js";import ye from"./D41WEms4.js";import{d as xe,r as i,J as je,k,o as ke,x as m,z as c,B as l,C as o,a as D,g as r,K as be,y as v,D as s,L as y,M,A as _,N as we,O as Ve,_ as Ce}from"./CBWR65Fw.js";const Pe={class:"topology-projects-page"},De={class:"topology-projects"},he={class:"d-flex justify-space-between align-center mb-6"},ze={key:0,class:"mr-4"},$e={key:0,class:"text-center pa-8"},Ae={key:1,class:"text-center pa-12"},Se={key:2,class:"pa-4 pb-0"},Be={class:"d-flex align-center"},Ue={key:3,class:"pa-4"},Ne={key:0,class:"d-flex justify-center mt-6"},Ie={class:"mb-4"},Me=xe({__name:"topology-projects",setup(Le){const R=be(),$=i(!1),A=i(!1),d=i([]),x=i(!1),b=i(!1),S=i(null),w=i(null),p=je({page:1,limit:12,total:0,pages:0}),u=i([]),V=i(!1),C=i(!1),j=i("soft"),B=i(!1),P=i("all"),h=k(()=>P.value==="all"?d.value:P.value==="active"?d.value.filter(t=>t.status!=="deleted"):P.value==="deleted"?d.value.filter(t=>t.status==="deleted"):d.value),T=k(()=>d.value.length),J=k(()=>d.value.filter(t=>t.status!=="deleted").length),K=k(()=>d.value.filter(t=>t.status==="deleted").length),q=k(()=>u.value.some(t=>{const e=d.value.find(a=>a.id===t);return e&&e.status==="deleted"})),G=k(()=>u.value.filter(t=>{const e=d.value.find(a=>a.id===t);return e&&e.status==="deleted"}).length),g=async()=>{$.value=!0;try{const{$topologyApi:t}=D(),e=await t.projects.getList({page:p.page,limit:p.limit,status:"active"});d.value=e.data.projects,p.total=e.data.pagination.total,p.pages=e.data.pagination.pages}catch(t){console.error("加载项目失败:",t)}finally{$.value=!1}},H=t=>{S.value=t,x.value=!0},Q=t=>{R.push(`/topology-editor/${t.id}`)},W=t=>{w.value=t,b.value=!0},X=async()=>{if(w.value){A.value=!0;try{const{$topologyApi:t}=D();await t.projects.delete(w.value.id),await g(),b.value=!1,w.value=null}catch(t){console.error("删除项目失败:",t)}finally{A.value=!1}}},Y=async t=>{try{const{$topologyApi:e}=D();await e.projects.create({project_name:`${t.project_name} - 副本`,description:t.description,text_content:""}),await g()}catch(e){console.error("复制项目失败:",e)}},Z=()=>{x.value=!1,S.value=null,g()},ee=t=>{const e=u.value.indexOf(t);e>-1?u.value.splice(e,1):u.value.push(t),le()},te=()=>{V.value?u.value=h.value.map(t=>t.id):u.value=[]},le=()=>{const t=h.value.map(a=>a.id),e=u.value.filter(a=>t.includes(a));V.value=e.length===t.length&&t.length>0},U=()=>{u.value=[],V.value=!1},oe=async()=>{if(u.value.length!==0){B.value=!0;try{const{$topologyApi:t}=D(),e=await t.projects.batchDelete({project_ids:u.value,hard_delete:j.value==="hard"});if(console.log("批量删除结果:",e),await g(),U(),C.value=!1,e.data){const{success:a,failed:f}=e.data;f.length>0&&console.warn("部分项目删除失败:",f)}}catch(t){console.error("批量删除失败:",t)}finally{B.value=!1}}},ae=async()=>{const t=u.value.filter(e=>{const a=d.value.find(f=>f.id===e);return a&&a.status==="deleted"});if(t.length!==0)try{const{$topologyApi:e}=D();for(const a of t)await e.projects.restore(a);await g(),U()}catch(e){console.error("批量恢复失败:",e)}};return ke(()=>{g()}),(t,e)=>{const a=r("v-btn"),f=r("v-icon"),z=r("v-spacer"),ne=r("v-chip"),N=r("v-card-title"),se=r("v-divider"),re=r("v-progress-circular"),ue=r("v-checkbox"),de=r("v-btn-toggle"),ie=fe,ce=r("v-col"),ve=r("v-row"),pe=r("v-pagination"),I=r("v-card"),_e=ye,L=r("v-card-text"),E=r("v-card-actions"),F=r("v-dialog"),O=r("v-radio"),me=r("v-radio-group"),ge=r("v-alert");return v(),m("div",Pe,[c("div",De,[c("div",he,[e[13]||(e[13]=c("div",null,[c("h1",{class:"text-h4 font-weight-bold text-grey-darken-2 mb-2"}," 网络拓扑项目管理 "),c("p",{class:"text-body-1 text-grey-darken-1"}," 管理和编辑网络拓扑项目，支持AI智能解析和可视化生成 ")],-1)),l(a,{color:"primary",size:"large","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=n=>x.value=!0),elevation:"2"},{default:o(()=>e[12]||(e[12]=[s(" 新建项目 ")])),_:1,__:[12]})]),l(I,{elevation:"1"},{default:o(()=>[l(N,{class:"d-flex align-center"},{default:o(()=>[l(f,{class:"mr-2"},{default:o(()=>e[14]||(e[14]=[s("mdi-folder-multiple-outline")])),_:1,__:[14]}),e[16]||(e[16]=s(" 项目列表 ")),l(z),u.value.length>0?(v(),m("div",ze,[l(a,{color:"warning",variant:"outlined",size:"small","prepend-icon":"mdi-delete-multiple",class:"mr-2",onClick:e[1]||(e[1]=n=>C.value=!0)},{default:o(()=>[s(" 批量删除 ("+_(u.value.length)+") ",1)]),_:1}),q.value?(v(),M(a,{key:0,color:"success",variant:"outlined",size:"small","prepend-icon":"mdi-restore",class:"mr-2",onClick:ae},{default:o(()=>[s(" 批量恢复 ("+_(G.value)+") ",1)]),_:1})):y("",!0),l(a,{variant:"text",size:"small",onClick:U},{default:o(()=>e[15]||(e[15]=[s(" 取消选择 ")])),_:1,__:[15]})])):y("",!0),l(ne,{color:d.value.length>0?"primary":"grey",variant:"outlined",size:"small"},{default:o(()=>[s(" 共 "+_(p.total)+" 个项目 ",1)]),_:1},8,["color"])]),_:1,__:[16]}),l(se),$.value?(v(),m("div",$e,[l(re,{indeterminate:"",color:"primary",size:"64"}),e[17]||(e[17]=c("p",{class:"text-body-1 text-grey-darken-1 mt-4"},"加载项目中...",-1))])):d.value.length===0?(v(),m("div",Ae,[l(f,{size:"80",color:"grey-lighten-1",class:"mb-4"},{default:o(()=>e[18]||(e[18]=[s(" mdi-folder-open-outline ")])),_:1,__:[18]}),e[20]||(e[20]=c("h3",{class:"text-h6 text-grey-darken-1 mb-2"},"暂无项目",-1)),e[21]||(e[21]=c("p",{class:"text-body-2 text-grey-darken-1 mb-4"}," 开始创建您的第一个网络拓扑项目 ",-1)),l(a,{color:"primary",variant:"outlined","prepend-icon":"mdi-plus",onClick:e[2]||(e[2]=n=>x.value=!0)},{default:o(()=>e[19]||(e[19]=[s(" 创建项目 ")])),_:1,__:[19]})])):y("",!0),d.value.length>0?(v(),m("div",Se,[c("div",Be,[l(ue,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=n=>V.value=n),indeterminate:u.value.length>0&&u.value.length<d.value.length,label:"全选","hide-details":"",onChange:te},null,8,["modelValue","indeterminate"]),l(z),l(de,{modelValue:P.value,"onUpdate:modelValue":e[4]||(e[4]=n=>P.value=n),mandatory:"",variant:"outlined",size:"small"},{default:o(()=>[l(a,{value:"all",size:"small"},{default:o(()=>[s(" 全部 ("+_(T.value)+") ",1)]),_:1}),l(a,{value:"active",size:"small"},{default:o(()=>[s(" 活跃 ("+_(J.value)+") ",1)]),_:1}),l(a,{value:"deleted",size:"small"},{default:o(()=>[s(" 已删除 ("+_(K.value)+") ",1)]),_:1})]),_:1},8,["modelValue"])])])):y("",!0),h.value.length>0?(v(),m("div",Ue,[l(ve,null,{default:o(()=>[(v(!0),m(we,null,Ve(h.value,n=>(v(),M(ce,{key:n.id,cols:"12",md:"6",lg:"4"},{default:o(()=>[l(ie,{project:n,selected:u.value.includes(n.id),onEdit:H,onDelete:W,onView:Q,onDuplicate:Y,onToggleSelect:ee},null,8,["project","selected"])]),_:2},1024))),128))]),_:1}),p.pages>1?(v(),m("div",Ne,[l(pe,{modelValue:p.page,"onUpdate:modelValue":[e[5]||(e[5]=n=>p.page=n),g],length:p.pages,"total-visible":7},null,8,["modelValue","length"])])):y("",!0)])):y("",!0)]),_:1}),l(_e,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=n=>x.value=n),project:S.value,onSaved:Z},null,8,["modelValue","project"]),l(F,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=n=>b.value=n),"max-width":"400"},{default:o(()=>[l(I,null,{default:o(()=>[l(N,{class:"text-h6"},{default:o(()=>e[22]||(e[22]=[s(" 确认删除项目 ")])),_:1,__:[22]}),l(L,null,{default:o(()=>{var n;return[s(' 确定要删除项目 "'+_((n=w.value)==null?void 0:n.project_name)+'" 吗？ ',1),e[23]||(e[23]=c("br",null,null,-1)),e[24]||(e[24]=c("span",{class:"text-error"},"此操作不可撤销。",-1))]}),_:1,__:[23,24]}),l(E,null,{default:o(()=>[l(z),l(a,{variant:"text",onClick:e[7]||(e[7]=n=>b.value=!1)},{default:o(()=>e[25]||(e[25]=[s(" 取消 ")])),_:1,__:[25]}),l(a,{color:"error",variant:"text",loading:A.value,onClick:X},{default:o(()=>e[26]||(e[26]=[s(" 删除 ")])),_:1,__:[26]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(F,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=n=>C.value=n),"max-width":"500"},{default:o(()=>[l(I,null,{default:o(()=>[l(N,{class:"text-h6"},{default:o(()=>e[27]||(e[27]=[s(" 批量删除项目 ")])),_:1,__:[27]}),l(L,null,{default:o(()=>[c("p",Ie," 确定要删除选中的 "+_(u.value.length)+" 个项目吗？ ",1),l(me,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=n=>j.value=n),"hide-details":""},{default:o(()=>[l(O,{label:"软删除（可恢复）",value:"soft",color:"warning"}),l(O,{label:"硬删除（永久删除，不可恢复）",value:"hard",color:"error"})]),_:1},8,["modelValue"]),j.value==="hard"?(v(),M(ge,{key:0,type:"error",variant:"tonal",class:"mt-4"},{default:o(()=>e[28]||(e[28]=[c("strong",null,"警告：",-1),s("硬删除操作不可撤销，将永久删除项目及其所有版本数据。 ")])),_:1,__:[28]})):y("",!0)]),_:1}),l(E,null,{default:o(()=>[l(z),l(a,{variant:"text",onClick:e[10]||(e[10]=n=>C.value=!1)},{default:o(()=>e[29]||(e[29]=[s(" 取消 ")])),_:1,__:[29]}),l(a,{color:j.value==="hard"?"error":"warning",variant:"text",loading:B.value,onClick:oe},{default:o(()=>[s(_(j.value==="hard"?"永久删除":"删除"),1)]),_:1},8,["color","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])}}}),Re=Ce(Me,[["__scopeId","data-v-6a8dab91"]]);export{Re as default};
