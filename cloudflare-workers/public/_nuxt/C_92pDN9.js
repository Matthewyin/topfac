import{d as it,r as z,k as dt,P as ut,M as ct,C as a,g as v,y as m,B as e,z as s,D as o,x as p,A as r,L as I,V as j,a as vt,_ as _t}from"./DAp-Rok4.js";const mt={class:"version-selector pa-4"},ft={key:0,class:"d-flex justify-center align-center",style:{height:"100%"}},pt={class:"text-center"},gt={key:1,class:"d-flex justify-center align-center",style:{height:"100%"}},xt={class:"text-center"},yt={key:2,class:"compare-content"},bt={class:"pa-4"},Vt={class:"info-grid"},wt={class:"info-item"},kt={class:"info-item"},Ct={class:"info-item"},zt={class:"info-item"},$t={class:"info-item"},Dt={class:"info-item"},ht={key:0,class:"parsed-stats mt-3"},Mt={class:"d-flex align-center"},Bt={class:"info-grid"},Tt={class:"info-item"},Nt={class:"info-item"},Lt={class:"info-item"},It={class:"info-item"},St={class:"info-item"},Ut={class:"info-item"},Ft={key:0,class:"parsed-stats mt-3"},At={class:"d-flex align-center"},Ot={class:"diff-summary mt-4"},jt={class:"summary-grid"},Jt={class:"summary-item"},Kt={class:"summary-item"},Pt={key:0,class:"summary-item"},Xt={key:1,class:"summary-item"},Et={class:"text-compare pa-4"},Gt={class:"text-h6 mb-3"},Ht={class:"text-content"},qt={class:"text-h6 mb-3"},Qt={class:"text-content"},Rt={class:"data-compare pa-4"},Wt={class:"text-h6 mb-3"},Yt={key:0,class:"parsed-data-text"},Zt={class:"data-content"},te={key:1,class:"text-center pa-4"},ee={class:"text-h6 mb-3"},se={key:0,class:"parsed-data-text"},ae={class:"data-content"},le={key:1,class:"text-center pa-4"},oe=it({__name:"VersionCompareDialog",props:{modelValue:{type:Boolean},versions:{}},emits:["update:modelValue","close"],setup(W,{emit:ne}){const Y=W,S=z(!1),N=z("overview"),k=z(""),C=z(""),d=z(null),u=z(null),J=dt(()=>Y.versions.map(l=>({title:`v${l.version} - ${F(l.status)}`,value:l._id})));ut([k,C],()=>{U()});const U=async()=>{if(!(!k.value||!C.value)){S.value=!0;try{const{$topologyApi:l}=vt(),[t,i]=await Promise.all([l.versions.getById(k.value),l.versions.getById(C.value)]);d.value=t.data,u.value=i.data}catch(l){console.error("加载版本数据失败:",l)}finally{S.value=!1}}},K=l=>({draft:"grey",parsed:"info",generated:"success",published:"primary"})[l]||"grey",F=l=>({draft:"草稿",parsed:"已解析",generated:"已生成",published:"已发布"})[l]||"未知",P=l=>l?new Date(l).toLocaleString("zh-CN"):"",X=l=>l<1e3?`${l} 字符`:`${(l/1e3).toFixed(1)}K 字符`,E=l=>{if(l===0)return"0 B";const t=1024,i=["B","KB","MB","GB"],_=Math.floor(Math.log(l)/Math.log(t));return parseFloat((l/Math.pow(t,_)).toFixed(1))+" "+i[_]},G=()=>{var t,i;if(!d.value||!u.value)return"0";const l=(((t=u.value.text_content)==null?void 0:t.length)||0)-(((i=d.value.text_content)==null?void 0:i.length)||0);return l>0?`+${l}`:`${l}`},Z=()=>{const l=parseInt(G());return l>0?"text-success":l<0?"text-error":"text-grey-darken-1"},tt=()=>{if(!d.value||!u.value)return"0";const l=new Date(d.value.created_at).getTime(),t=new Date(u.value.created_at).getTime(),i=Math.abs(t-l),_=Math.floor(i/(1e3*60*60*24)),f=Math.floor(i%(1e3*60*60*24)/(1e3*60*60)),$=Math.floor(i%(1e3*60*60)/(1e3*60));return _>0?`${_} 天`:f>0?`${f} 小时`:`${$} 分钟`},H=()=>{var _,f;if(!((_=d.value)!=null&&_.parsed_data)||!((f=u.value)!=null&&f.parsed_data))return"0";const l=(d.value.parsed_data.components||[]).length,i=(u.value.parsed_data.components||[]).length-l;return i>0?`+${i}`:`${i}`},et=()=>{const l=parseInt(H());return l>0?"text-success":l<0?"text-error":"text-grey-darken-1"},q=()=>{var _,f;if(!((_=d.value)!=null&&_.parsed_data)||!((f=u.value)!=null&&f.parsed_data))return"0";const l=(d.value.parsed_data.connections||[]).length,i=(u.value.parsed_data.connections||[]).length-l;return i>0?`+${i}`:`${i}`},st=()=>{const l=parseInt(q());return l>0?"text-success":l<0?"text-error":"text-grey-darken-1"};return(l,t)=>{const i=v("v-icon"),_=v("v-spacer"),f=v("v-btn"),$=v("v-card-title"),Q=v("v-divider"),R=v("v-select"),g=v("v-col"),L=v("v-row"),at=v("v-progress-circular"),A=v("v-tab"),lt=v("v-tabs"),x=v("v-chip"),y=v("v-card-text"),b=v("v-card"),O=v("v-tabs-window-item"),ot=v("v-tabs-window"),nt=v("v-card-actions"),rt=v("v-dialog");return m(),ct(rt,{"model-value":l.modelValue,"onUpdate:modelValue":t[6]||(t[6]=n=>l.$emit("update:modelValue",n)),"max-width":"1200",scrollable:""},{default:a(()=>[e(b,{class:"version-compare-dialog"},{default:a(()=>[e($,{class:"d-flex align-center"},{default:a(()=>[e(i,{class:"mr-3",color:"primary"},{default:a(()=>t[7]||(t[7]=[o("mdi-compare")])),_:1,__:[7]}),t[8]||(t[8]=s("span",{class:"text-h5 font-weight-bold"},"版本比较",-1)),e(_),e(f,{icon:"mdi-close",variant:"text",onClick:t[0]||(t[0]=n=>l.$emit("update:modelValue",!1))})]),_:1,__:[8]}),e(Q),s("div",mt,[e(L,null,{default:a(()=>[e(g,{cols:"6"},{default:a(()=>[e(R,{modelValue:k.value,"onUpdate:modelValue":[t[1]||(t[1]=n=>k.value=n),U],items:J.value,label:"选择版本 1",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(g,{cols:"6"},{default:a(()=>[e(R,{modelValue:C.value,"onUpdate:modelValue":[t[2]||(t[2]=n=>C.value=n),U],items:J.value,label:"选择版本 2",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),_:1})]),_:1})]),e(Q),e(y,{class:"pa-0",style:{height:"70vh"}},{default:a(()=>[S.value?(m(),p("div",ft,[s("div",pt,[e(at,{indeterminate:"",color:"primary",size:"48"}),t[9]||(t[9]=s("p",{class:"text-body-2 text-grey-darken-1 mt-4"},"加载版本数据中...",-1))])])):!k.value||!C.value?(m(),p("div",gt,[s("div",xt,[e(i,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:a(()=>t[10]||(t[10]=[o(" mdi-compare ")])),_:1,__:[10]}),t[11]||(t[11]=s("h4",{class:"text-h6 text-grey-darken-1 mb-2"},"选择要比较的版本",-1)),t[12]||(t[12]=s("p",{class:"text-body-2 text-grey-darken-1"}," 请在上方选择两个版本进行比较 ",-1))])])):(m(),p("div",yt,[e(lt,{modelValue:N.value,"onUpdate:modelValue":t[3]||(t[3]=n=>N.value=n),class:"compare-tabs"},{default:a(()=>[e(A,{value:"overview"},{default:a(()=>t[13]||(t[13]=[o("概览对比")])),_:1,__:[13]}),e(A,{value:"text"},{default:a(()=>t[14]||(t[14]=[o("文本对比")])),_:1,__:[14]}),e(A,{value:"data"},{default:a(()=>t[15]||(t[15]=[o("数据对比")])),_:1,__:[15]})]),_:1},8,["modelValue"]),e(ot,{modelValue:N.value,"onUpdate:modelValue":t[4]||(t[4]=n=>N.value=n),class:"compare-window"},{default:a(()=>[e(O,{value:"overview",class:"overview-tab"},{default:a(()=>[s("div",bt,[e(L,null,{default:a(()=>[e(g,{cols:"6"},{default:a(()=>[e(b,{variant:"outlined",class:"version-info-card"},{default:a(()=>[e($,{class:"d-flex align-center"},{default:a(()=>{var n;return[e(i,{class:"mr-2",color:"primary"},{default:a(()=>t[16]||(t[16]=[o("mdi-numeric-1-circle")])),_:1,__:[16]}),o(" 版本 v"+r((n=d.value)==null?void 0:n.version),1)]}),_:1}),e(y,null,{default:a(()=>{var n,c,V,w,D,h,M,B;return[s("div",Vt,[s("div",wt,[t[17]||(t[17]=s("strong",null,"创建时间：",-1)),o(" "+r(P((n=d.value)==null?void 0:n.created_at)),1)]),s("div",kt,[t[18]||(t[18]=s("strong",null,"状态：",-1)),e(x,{color:K((c=d.value)==null?void 0:c.status),variant:"flat",size:"small",class:"text-white"},{default:a(()=>{var T;return[o(r(F((T=d.value)==null?void 0:T.status)),1)]}),_:1},8,["color"])]),s("div",Ct,[t[19]||(t[19]=s("strong",null,"文本长度：",-1)),o(" "+r(X(((w=(V=d.value)==null?void 0:V.text_content)==null?void 0:w.length)||0)),1)]),s("div",zt,[t[20]||(t[20]=s("strong",null,"文件大小：",-1)),o(" "+r(E(((D=d.value)==null?void 0:D.file_size)||0)),1)]),s("div",$t,[t[21]||(t[21]=s("strong",null,"解析状态：",-1)),o(" "+r((h=d.value)!=null&&h.parsed_data?"已解析":"未解析"),1)]),s("div",Dt,[t[22]||(t[22]=s("strong",null,"XML状态：",-1)),o(" "+r((M=d.value)!=null&&M.xml_content?"已生成":"未生成"),1)])]),(B=d.value)!=null&&B.parsed_data?(m(),p("div",ht,[t[23]||(t[23]=s("h4",{class:"text-subtitle-1 mb-2"},"解析结果统计",-1)),s("div",Mt,[e(x,{size:"small",variant:"outlined",color:"info",class:"mr-1"},{default:a(()=>[o(r((d.value.parsed_data.regions||[]).length)+" 区域 ",1)]),_:1}),e(x,{size:"small",variant:"outlined",color:"success",class:"mr-1"},{default:a(()=>[o(r((d.value.parsed_data.components||[]).length)+" 组件 ",1)]),_:1}),e(x,{size:"small",variant:"outlined",color:"warning"},{default:a(()=>[o(r((d.value.parsed_data.connections||[]).length)+" 连接 ",1)]),_:1})])])):I("",!0)]}),_:1})]),_:1})]),_:1}),e(g,{cols:"6"},{default:a(()=>[e(b,{variant:"outlined",class:"version-info-card"},{default:a(()=>[e($,{class:"d-flex align-center"},{default:a(()=>{var n;return[e(i,{class:"mr-2",color:"secondary"},{default:a(()=>t[24]||(t[24]=[o("mdi-numeric-2-circle")])),_:1,__:[24]}),o(" 版本 v"+r((n=u.value)==null?void 0:n.version),1)]}),_:1}),e(y,null,{default:a(()=>{var n,c,V,w,D,h,M,B;return[s("div",Bt,[s("div",Tt,[t[25]||(t[25]=s("strong",null,"创建时间：",-1)),o(" "+r(P((n=u.value)==null?void 0:n.created_at)),1)]),s("div",Nt,[t[26]||(t[26]=s("strong",null,"状态：",-1)),e(x,{color:K((c=u.value)==null?void 0:c.status),variant:"flat",size:"small",class:"text-white"},{default:a(()=>{var T;return[o(r(F((T=u.value)==null?void 0:T.status)),1)]}),_:1},8,["color"])]),s("div",Lt,[t[27]||(t[27]=s("strong",null,"文本长度：",-1)),o(" "+r(X(((w=(V=u.value)==null?void 0:V.text_content)==null?void 0:w.length)||0)),1)]),s("div",It,[t[28]||(t[28]=s("strong",null,"文件大小：",-1)),o(" "+r(E(((D=u.value)==null?void 0:D.file_size)||0)),1)]),s("div",St,[t[29]||(t[29]=s("strong",null,"解析状态：",-1)),o(" "+r((h=u.value)!=null&&h.parsed_data?"已解析":"未解析"),1)]),s("div",Ut,[t[30]||(t[30]=s("strong",null,"XML状态：",-1)),o(" "+r((M=u.value)!=null&&M.xml_content?"已生成":"未生成"),1)])]),(B=u.value)!=null&&B.parsed_data?(m(),p("div",Ft,[t[31]||(t[31]=s("h4",{class:"text-subtitle-1 mb-2"},"解析结果统计",-1)),s("div",At,[e(x,{size:"small",variant:"outlined",color:"info",class:"mr-1"},{default:a(()=>[o(r((u.value.parsed_data.regions||[]).length)+" 区域 ",1)]),_:1}),e(x,{size:"small",variant:"outlined",color:"success",class:"mr-1"},{default:a(()=>[o(r((u.value.parsed_data.components||[]).length)+" 组件 ",1)]),_:1}),e(x,{size:"small",variant:"outlined",color:"warning"},{default:a(()=>[o(r((u.value.parsed_data.connections||[]).length)+" 连接 ",1)]),_:1})])])):I("",!0)]}),_:1})]),_:1})]),_:1})]),_:1}),s("div",Ot,[t[36]||(t[36]=s("h4",{class:"text-h6 mb-3"},"差异摘要",-1)),e(b,{variant:"outlined"},{default:a(()=>[e(y,null,{default:a(()=>{var n,c,V,w;return[s("div",jt,[s("div",Jt,[t[32]||(t[32]=s("strong",null,"文本长度差异：",-1)),s("span",{class:j(Z())},r(G()),3)]),s("div",Kt,[t[33]||(t[33]=s("strong",null,"创建时间间隔：",-1)),o(" "+r(tt()),1)]),(n=d.value)!=null&&n.parsed_data&&((c=u.value)!=null&&c.parsed_data)?(m(),p("div",Pt,[t[34]||(t[34]=s("strong",null,"组件数量差异：",-1)),s("span",{class:j(et())},r(H()),3)])):I("",!0),(V=d.value)!=null&&V.parsed_data&&((w=u.value)!=null&&w.parsed_data)?(m(),p("div",Xt,[t[35]||(t[35]=s("strong",null,"连接数量差异：",-1)),s("span",{class:j(st())},r(q()),3)])):I("",!0)])]}),_:1})]),_:1})])])]),_:1}),e(O,{value:"text",class:"text-tab"},{default:a(()=>[s("div",Et,[e(L,null,{default:a(()=>[e(g,{cols:"6"},{default:a(()=>{var n;return[s("h4",Gt,[e(i,{class:"mr-2",color:"primary"},{default:a(()=>t[37]||(t[37]=[o("mdi-numeric-1-circle")])),_:1,__:[37]}),o(" 版本 v"+r((n=d.value)==null?void 0:n.version)+" 文本 ",1)]),e(b,{variant:"outlined",class:"text-content-card"},{default:a(()=>[e(y,null,{default:a(()=>{var c;return[s("pre",Ht,r(((c=d.value)==null?void 0:c.text_content)||"暂无内容"),1)]}),_:1})]),_:1})]}),_:1}),e(g,{cols:"6"},{default:a(()=>{var n;return[s("h4",qt,[e(i,{class:"mr-2",color:"secondary"},{default:a(()=>t[38]||(t[38]=[o("mdi-numeric-2-circle")])),_:1,__:[38]}),o(" 版本 v"+r((n=u.value)==null?void 0:n.version)+" 文本 ",1)]),e(b,{variant:"outlined",class:"text-content-card"},{default:a(()=>[e(y,null,{default:a(()=>{var c;return[s("pre",Qt,r(((c=u.value)==null?void 0:c.text_content)||"暂无内容"),1)]}),_:1})]),_:1})]}),_:1})]),_:1})])]),_:1}),e(O,{value:"data",class:"data-tab"},{default:a(()=>[s("div",Rt,[e(L,null,{default:a(()=>[e(g,{cols:"6"},{default:a(()=>{var n;return[s("h4",Wt,[e(i,{class:"mr-2",color:"primary"},{default:a(()=>t[39]||(t[39]=[o("mdi-numeric-1-circle")])),_:1,__:[39]}),o(" 版本 v"+r((n=d.value)==null?void 0:n.version)+" 解析数据 ",1)]),e(b,{variant:"outlined",class:"data-content-card"},{default:a(()=>[e(y,null,{default:a(()=>{var c;return[(c=d.value)!=null&&c.parsed_data?(m(),p("div",Yt,[s("pre",Zt,r(JSON.stringify(d.value.parsed_data,null,2)),1)])):(m(),p("div",te,[e(i,{size:"48",color:"grey-lighten-1",class:"mb-2"},{default:a(()=>t[40]||(t[40]=[o(" mdi-database-off-outline ")])),_:1,__:[40]}),t[41]||(t[41]=s("p",{class:"text-body-2 text-grey-darken-1"},"暂无解析数据",-1))]))]}),_:1})]),_:1})]}),_:1}),e(g,{cols:"6"},{default:a(()=>{var n;return[s("h4",ee,[e(i,{class:"mr-2",color:"secondary"},{default:a(()=>t[42]||(t[42]=[o("mdi-numeric-2-circle")])),_:1,__:[42]}),o(" 版本 v"+r((n=u.value)==null?void 0:n.version)+" 解析数据 ",1)]),e(b,{variant:"outlined",class:"data-content-card"},{default:a(()=>[e(y,null,{default:a(()=>{var c;return[(c=u.value)!=null&&c.parsed_data?(m(),p("div",se,[s("pre",ae,r(JSON.stringify(u.value.parsed_data,null,2)),1)])):(m(),p("div",le,[e(i,{size:"48",color:"grey-lighten-1",class:"mb-2"},{default:a(()=>t[43]||(t[43]=[o(" mdi-database-off-outline ")])),_:1,__:[43]}),t[44]||(t[44]=s("p",{class:"text-body-2 text-grey-darken-1"},"暂无解析数据",-1))]))]}),_:1})]),_:1})]}),_:1})]),_:1})])]),_:1})]),_:1},8,["modelValue"])]))]),_:1}),e(nt,{class:"pa-6 pt-0"},{default:a(()=>[e(_),e(f,{variant:"outlined",onClick:t[5]||(t[5]=n=>l.$emit("update:modelValue",!1))},{default:a(()=>t[45]||(t[45]=[o(" 关闭 ")])),_:1,__:[45]})]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),ie=_t(oe,[["__scopeId","data-v-41c3caf5"]]);export{ie as default};
